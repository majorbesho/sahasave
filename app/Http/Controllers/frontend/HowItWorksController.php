<?php

namespace App\Http\Controllers\frontend;

use App\Http\Controllers\Controller;
use App\Models\Step;
use App\Models\Faq;
use Illuminate\Http\Request;

class HowItWorksController extends Controller
{
    /**
     * عرض صفحة كيف تعمل المنصة
     */
    public function index()
    {
        // خطوات العمل (يمكن إضافتها من قاعدة البيانات لاحقاً)
        $steps = [
            [
                'id' => 1,
                'phase' => 'المرحلة الأولى',
                'phase_title' => 'البحث والاختيار',
                'icon' => 'fas fa-search',
                'color' => '#3B82F6',
                'steps' => [
                    [
                        'number' => 1,
                        'title' => 'ابدأ البحث',
                        'description' => 'قم بتسجيل الدخول إلى المنصة وابحث عن الخدمة الطبية أو التخصص الذي تحتاجه (مثلاً: طبيب أسنان، مركز علاج طبيعي، عيادة جلدية).',
                        'benefit' => 'توفير الوقت: إيجاد الخيارات المتاحة والموثوقة بسرعة.'
                    ],
                    [
                        'number' => 2,
                        'title' => 'قارن الخيارات',
                        'description' => 'استعرض ملفات مقدمي الخدمات الطبية (الأطباء، العيادات، المراكز)، واقرأ التقييمات والمراجعات الموثوقة من مرضى آخرين.',
                        'benefit' => 'ضمان الجودة: اتخاذ قرار حجز مبني على تقييمات حقيقية.'
                    ],
                    [
                        'number' => 3,
                        'title' => 'اختر الموعد',
                        'description' => 'حدد الطبيب المناسب، ثم اختر التاريخ والوقت المناسبين لك من جدول مواعيده المتاح عبر المنصة.',
                        'benefit' => 'المرونة والراحة: حجز الموعد الذي يناسب جدولك مباشرةً.'
                    ]
                ]
            ],
            [
                'id' => 2,
                'phase' => 'المرحلة الثانية',
                'phase_title' => 'الحجز والاستفادة من الحافز',
                'icon' => 'fas fa-money-bill-wave',
                'color' => '#10B981',
                'steps' => [
                    [
                        'number' => 4,
                        'title' => 'تأكيد الحجز عبر sehaSave',
                        'description' => 'قم بإتمام عملية الحجز عبر المنصة. ستظهر لك القيمة الإجمالية للخدمة وتفاصيل الخصم الفوري أو مبلغ الكاش باك المتوقع استرداده.',
                        'benefit' => 'القيمة المضافة: ضمان حصولك على الحافز المالي (الذي يمثل جزءاً من عمولة المنصة).'
                    ],
                    [
                        'number' => 5,
                        'title' => 'نفّذ الزيارة الطبية',
                        'description' => 'قم بزيارة مقدم الخدمة في الموعد المحدد. (يتم إخطار الطبيب بتفاصيل الحجز المسبقة من المنصة).',
                        'benefit' => 'خدمة سلسة: التأكد من أن حجزك مؤكد ومعروف لدى مقدم الخدمة.'
                    ],
                    [
                        'number' => 6,
                        'title' => 'تأكيد الخدمة',
                        'description' => 'بعد الانتهاء من تلقي الخدمة، يقوم مقدم الخدمة بتأكيد إتمام الزيارة عبر نظام المنصة.',
                        'benefit' => 'دقة الحساب: تفعيل نظام العمولة بين المنصة والطبيب، استعداداً لتوزيع حافزك.'
                    ]
                ]
            ],
            [
                'id' => 3,
                'phase' => 'المرحلة الثالثة',
                'phase_title' => 'استلام مكافأتك',
                'icon' => 'fas fa-gift',
                'color' => '#F59E0B',
                'steps' => [
                    [
                        'number' => 7,
                        'title' => 'استلام الكاش باك',
                        'description' => 'يتم تحويل مبلغ الكاش باك المتفق عليه مباشرة إلى محفظتك الإلكترونية في منصة sehaSave.',
                        'benefit' => 'المكافأة المالية: تجميع رصيد في محفظتك يمكنك استخدامه في حجوزات مستقبلية أو سحبه نقداً (حسب شروط السحب).'
                    ],
                    [
                        'number' => 8,
                        'title' => 'كرر التوفير!',
                        'description' => 'يمكنك استخدام رصيد المحفظة لدفع جزء من قيمة حجوزاتك القادمة عبر المنصة، مما يزيد من توفيرك في كل مرة!',
                        'benefit' => 'برنامج الولاء: نظام يكافئك على استمرارك في استخدام المنصة، ويحولك من مستخدم إلى شريك في التوفير.'
                    ]
                ]
            ]
        ];

        // ميزات تنافسية
        $features = [
            [
                'icon' => 'fas fa-hand-holding-usd',
                'title' => 'الولاء والكاش باك',
                'description' => 'بخلاف منصات الحجز التقليدية، sehaSave تمنحك قيمة ملموسة. فجزء من العمولة التي نحصل عليها من الطبيب يعود إليك على شكل حافز.'
            ],
            [
                'icon' => 'fas fa-heart',
                'title' => 'رعاية صحية بأسعار أقل',
                'description' => 'هذا يخلق ولاءً لك تجاه المنصة ويجعل الرعاية الصحية ذات قيمة أعلى وأقل تكلفة.'
            ],
            [
                'icon' => 'fas fa-shield-alt',
                'title' => 'خدمة موثوقة وآمنة',
                'description' => 'جميع الخدمات والمدفوعات مؤمنة ومشفرة لضمان أمان بياناتك وخصوصيتك.'
            ],
            [
                'icon' => 'fas fa-clock',
                'title' => 'توفير الوقت والجهد',
                'description' => 'ابحث، قارن، واحجز في مكان واحد بدون الحاجة للبحث في مواقع متعددة.'
            ]
        ];

        // إحصائيات
        $stats = [
            [
                'icon' => 'fas fa-users',
                'value' => '50,000+',
                'label' => 'مستخدم راضي'
            ],
            [
                'icon' => 'fas fa-hospital-user',
                'value' => '500+',
                'label' => 'طبيب متعاون'
            ],
            [
                'icon' => 'fas fa-calendar-check',
                'value' => '100,000+',
                'label' => 'حجز ناجح'
            ],
            [
                'icon' => 'fas fa-money-bill-alt',
                'value' => '5M+',
                'label' => 'ريال وفرها المستخدمون'
            ]
        ];

        // الأسئلة الشائعة المتعلقة بكيفية العمل
        $faqs = Faq::where('status', 'active')
            ->where('title', 'like', '%كيف%')
            ->orWhere('title', 'like', '%عمل%')
            ->orWhere('qu', 'like', '%كيف%')
            ->limit(6)
            ->get();

        return view('frontend.how-it-works', compact('steps', 'features', 'stats', 'faqs'));
    }
}
